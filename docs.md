# Документация

## Описание
Данная программа позволяет создавать индивидуальные планы преподавателей кафедры. Создано приложение на основе фреймворка **Electron** с использованием современных веб-технологий. Текущая версия приложения предназначена только для операционных систем Windows 10 и выше.

### Развёртывание
> [!IMPORTANT]
> Перед началом необходимо установить `node`, `npm`, `python`

1. Создаём папку, в которой хотим развернуть проект, после чего вводим в консоли (находясь в созданной папке) `npm init` и протыкиваем всё через `enter`
2. После инциализации проекта прописываем в консоли:
   ```
   npm install electron --save-dev
   ```
4. Импортируем проект с текущего репозитория в папку с нашим инициализированным проектом
5. Запуск программы:
   ```
   npm run start
   ```
6. Сборка программы:
   ```
   npm run make
   ```

---

### Electron
**Electron** -  фреймворк, разработанный GitHub. Позволяет разрабатывать нативные графические приложения для операционных систем с помощью веб-технологий, комбинируя возможности Node.js для работы с back-end и браузера Chromium.

> Файлы JavaScript на фреймворке можно разделить на три ключевых типа:
> 1)main.js - главный скрипт, выполняющий роль backend сервера, через него подключается база данных и выполняется главная логика приложения.
> 2)render*.js - скрипт для страниц HTML, предназначен для работы приложения со стороны клиента. (* - для каждой страницы создаётся свой render.js, вместо * подставляется слово-обозначение для отличия от остальных файлов).
> 3)preload.js - скрипт прослойка между render.js и main.js, выполняет роль моста, который связывает пользователя с локальным сервером и передаёт данные в виде json данных.

Официальная документация Electron: https://www.electronjs.org/ru/docs/latest/

> [!IMPORTANT]
> Поскольку Electron работает на основе Chromium, он соблюдает один из принципов безопасности, который запрещает напрямую использовать данные одной страницы, на другой. Выливается это в проблему, при которой мы создаём страницу, присваиваем ей файл *.js и внутри него нам запрещается импортировать какие-либо ещё файлы *.js

> [!IMPORTANT]
> Помимо этого, из-за обновлённой политики Chromium новые приложения, разработанные на последних версиях Electron, больше не поддерживаются и не могут быть запущены на версиях операционных систем ниже Windows 10.

---

### Архитектура приложения
Пути проекта:
- /html - все файлы html страниц приложения;
- /css - все файлы css страниц приложения;
- /js - все файлы js страниц приложения;
- /fonts - все необходимые шрифты для страниц приложения;
- /img - все необходимые изображения, выводимые страницах приложений.

> Поскольку приложение работает на основе веб-технологий, для взаимодействия с пользователем необходимо создавать основные страницы с помощью html, css, js файлов.

> На данный момент создано 6 страниц для взаимодействия с пользователем: "Распределение нагрузки", "Статистика о преподавателях", "Учебный план", "Дисциплины", "Типы предметов", "Потоки и группы", "Преподаватели кафедры". 

> Front-end: render.js, renderPersonalHours.js, renderSyllabus.js, renderDisciplines.js, renderTypes.js, renderFlows.js, renderKafedra.js
> Прослойка: preload.js
> Back-end: main.js

Передача данных между front-end и back-end происходит с помощью прослойки в виде preload.js, в котором задаётся название метода, вызываемого на front'е и определённое название соединения для back'а, которому уже присваивается уникальная обработка полученных данных, которые передаются в формате JSON.

### JavaScript файлы

**main.js**
> Подключённые модули nodejs:
> - sqlite3 - библиотека для работы с базой данных SQLite.
> - xlsx - библиотека для работы с xlsx файлами.
> - fs - файловый менеджер для работы с файлами. 
> 
> app.whenReady() - метод, запускающийся при старте приложения.
> 
> createWindow() - метод, создающий окно приложения.
> - BrowserWindow - объект, внутри которого указан словарь с параметрами для создаваемого окна:
> width - ширина,
> height - высота,
> webPreferences - особенности веба
> 	preload - путь до preload.js
> BrowserWindow.loadFile(path) - метод для загрузки страницы. В текущем положении запускает index.html, так как метод вызывается при запуске приложения. 
> path - путь до запускаемого html файла.
> 
> ipcMain.handle(name, params) - метод, принимающий данные из preload.js.
> - name - название пути, который принимает метод.
> - params - параметры, которые получает метод.
> checkDatabaseTables() - метод, проверяющий существование всех необходимых таблиц.
> 
> getX, setX, updateX, deleteX - методы для добавления, изменения, удаления, обновления данных в таблицах.

**preload.js**
> Предоставляет безопасный API для взаимодействия между renderer-процессом и main-процессом.
> 
> Методы:
> 1)Для получения данных (get...)
> 2)Для обновления данных (update...)
> 3)Для вставки данных (insert...)
> 4)Для удаления данных (delete...)

**renderDisciplines.js**
> Управление таблицей дисциплин с возможностью добавления, редактирования и удаления записей.
> 
> Основные функции:
> 1)getDataAndCreateTable() - получает данные о дисциплинах и создает таблицу
> 2)createTableOfDisciplines(data) - рендерит таблицу дисциплин
> 3)updateCurTable() - обновляет таблицу
> 
> Элементы управления:
> 1)Кнопка добавления новой дисциплины
> 2)Кнопки редактирования/сохранения для каждой строки
> 3)Кнопки удаления для каждой строки
> 
> IPC-взаимодействие:
> 1)getDisciplines() - получение списка дисциплин
> 2)insertDiscipline(data) - добавление новой дисциплины
> 3)updateDisciplinesTable(data) - обновление дисциплины
> 4)deleteDiscipline(data) - удаление дисциплины

**renderFlows.js**
> Управление потоками и группами студентов.
> 
> Основные функции:
> 1)updateTables() - обновляет таблицы потоков и групп
> 2)createTableFromDatabase(database, containerID) - создает таблицу потоков или групп
> 
> Элементы управления:
> 1)Кнопки добавления/удаления потоков и групп
> 2)Редактируемые ячейки таблицы
> 
> IPC-взаимодействие:
> 1)getDatabaseTable('flows') - получение списка потоков
> 2)getGroups('') - получение списка групп
> 3)insertFlow(data) - добавление потока
> 4)insertGroup(data) - добавление группы
> 5)deleteFlow(data) - удаление потока
> 6)deleteGroup(data) - удаление группы

**renderKafedra.js**
> Управление кафедрой и преподавателями.
> 
> Основные функции:
> 1)updateCurTables() - обновляет список преподавателей
> 2)updateTablePersonalInfo(data) - показывает детальную информацию о преподавателе
> 3)updatePersonalInfo(id) - обновляет информацию о преподавателе
> 
> Элементы управления:
> 1)Список преподавателей слева
> 2)Форма редактирования справа
> 3)Кнопки добавления/удаления/сохранения
> 
> IPC-взаимодействие:
> 1)getDatabaseTable('kafedra') - получение списка преподавателей
> 2)insertPerson(data) - добавление преподавателя
> 3)updateKafTable(data) - обновление данных преподавателя
> 4)deletePerson(data) - удаление преподавателя

**renderPersonalHours.js**
> Просмотр персональной нагрузки преподавателей.
> 
> Основные функции:
> 1)updateSelectorTeachers() - обновляет список преподавателей
> 2)updateTeacherList(data) - показывает нагрузку выбранного преподавателя
> 3)createHeadRow() - создает заголовок таблицы
> 
> Элементы управления:
> 1)Выпадающие списки для выбора года, формы обучения и преподавателя
> 2)Кнопка получения данных
> 
> IPC-взаимодействие:
> 1)getCurTeachers([]) - получение списка преподавателей
> 2)getCurListTeachers(data) - получение нагрузки преподавателя

**renderSyllabus.js**
> Управление учебными планами (syllabus).
>
> Основные функции:
> 1)createTableFromDatabase(database) - создает таблицу учебных планов
> 2)updateCurTable() - обновляет таблицу
> 
> Элементы управления:
> 1)Кнопки добавления/редактирования/удаления
> 2)Форма с выпадающими списками для потоков, дисциплин и типов занятий
> 
> IPC-взаимодействие:
> 1)getSyllabus([]) - получение учебных планов
> 2)getFlows(dataTo) - получение потоков
> 3)getDisciplines(dataTo) - получение дисциплин
> 4)getTypes(dataTo) - получение типов занятий
> 5)insertSyllabus(data) - добавление учебного плана
> 6)updateSyllabusTable(data) - обновление учебного плана
> 7)deleteSyllabus(data) - удаление учебного плана

**renderTypes.js**
> Управление типами занятий.
> 
> Основные функции:
> 1)getDataAndCreateTable() - получает данные и создает таблицу
> 2)createTableOfDisciplines(data) - рендерит таблицу типов
> 3)updateCurTable() - обновляет таблицу
> 
> Элементы управления:
> 1)Кнопки добавления/редактирования/удаления
> 
> IPC-взаимодействие:
> 1)getTypes() - получение типов
> 2)insertType(data) - добавление типа
> 3)updateTypesTable(data) - обновление типа
> 4)deleteType(data) - удаление типа

---

## База данных
Используется SQLite, поскольку она полностью удовлетворяет своими возможностями необходимые требования для работы приложения. 

> Основные таблицы: kafedra, flows, groups, disciplines, types, syllabus, personal_plan, personal_hours

---

## Страницы приложения
Описание основных страниц приложения, что делают и с чем взаимодействуют.

> [!NOTE]
> В последующих описаниях будут указываться только конкретные html и js файлы, поскольку каждая страница взаимодействует со всеми css файлами.

### Распределение нагрузки
Основная страница, на которой пользователь распределяет нагрузку между преподавателями на определённый год, семестр, форму обучения.

Файлы страницы: `index.html`, `render.js`

> [!NOTE]
> Зависит от страниц: "Учебный план", "Преподаватели кафедры"

### Статистика о преподавателях
Предпросмотр статистики о преподавателях по определённым фильтрам (год, форма обучения). В будущем планируется добавить возможность предпросмотра и вывода статистики в виде *.docx файла.

Файлы страницы: `personalHours.html`, `renderPersonalHours.js`

> [!NOTE]
> Зависит от страниц: "Распределение нагрузки"

### Учебный план
Составление учебного плана для потоков и групп. Для определённых потоков/групп присваивается дисциплина, тип, семестр, количество часов на каждую подгруппу и количество часов в общем (сумма всех часов подгрупп).

Файлы страницы: `syllabus.html`, `renderSyllabus.js`

> [!NOTE]
> Зависит от страниц: "Дисциплины", "Типы предметов", "Потоки и группы"

### Дисциплины
Создание, изменение и удаление дисциплин.

Файлы страницы: `disciplines.html`, `renderDisciplines.js`

> [!NOTE]
> Исползуется на страницах: "Учебный план"

### Типы предметов
Создание, изменение и удаление типов предметов.

Файлы страницы: `types.html`, `renderTypes.js`

> [!NOTE]
> Используется на страницах: "Учебный план"

### Потоки и группы
Создание, изменение и удаление потоков и групп. Сначала создаются потоки и после к ним присваиваются группы.

Файлы страницы: `flows.html`, `renderFlows.js`

> [!NOTE]
> Используется на страницах: "Учебный план"

### Преподаватели кафедры
Создание, изменение и удаление информации о преподавателях.

Файлы страницы: `kafedra.html`, `renderKafedra.js`

> [!NOTE]
> Используется на страницах: "Учебный план", "Статистика о преподавателях"



